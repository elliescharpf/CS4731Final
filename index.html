<!DOCTYPE html>
<html>

<!-- Main Vertex Shader -->
<script id="vertex-shader" type="x-shader/x-vertex">
    attribute vec4 vPosition;
    attribute vec3 vNormal;

    uniform mat4 modelMatrix;
    uniform mat4 viewMatrix;
    uniform mat4 projMatrix;

    varying vec3 fNormal;
    varying vec3 fPos;

    void main() {
        vec4 worldPos = modelMatrix * vPosition;
        fPos = worldPos.xyz;
        fNormal = mat3(modelMatrix) * vNormal;

        gl_Position = projMatrix * viewMatrix * worldPos;
    }
</script>

<!-- Main Fragment Shader -->
<script id="fragment-shader" type="x-shader/x-fragment">
    precision mediump float;

    varying vec3 fNormal;
    varying vec3 fPos;

    uniform vec3 lightPos;
    uniform vec3 cameraPos;

    uniform vec4 ambientProduct;
    uniform vec4 diffuseProduct;
    uniform vec4 specularProduct;
    uniform float shininess;

    void main() {
        vec3 N = normalize(fNormal);
        vec3 L = normalize(lightPos - fPos);
        vec3 V = normalize(cameraPos - fPos);
        vec3 R = reflect(-L, N);

        float diff = max(dot(N, L), 0.0);
        float spec = pow(max(dot(V, R), 0.0), shininess);

        vec4 color = ambientProduct +
                     diffuseProduct * diff +
                     specularProduct * spec;

        gl_FragColor = color;
    }
</script>

<!-- Skybox Vertex Shader -->
<script id="skybox-vertex" type="x-shader/x-vertex">
    attribute vec3 aPosition;

    uniform mat4 viewMatrix;
    uniform mat4 projMatrix;

    varying vec3 vDir;

    void main() {
        // direction for cubemap lookup
        vDir = aPosition;
        // remove translation from view
        mat4 v = viewMatrix;
        v[0][3] = 0.0;
        v[1][3] = 0.0;
        v[2][3] = 0.0;
        gl_Position = projMatrix * v * vec4(aPosition, 1.0);
    }
</script>

<!-- Skybox Fragment Shader -->
<script id="skybox-fragment" type="x-shader/x-fragment">
    precision mediump float;

    varying vec3 vDir;
    uniform samplerCube uSkybox;

    void main() {
        gl_FragColor = textureCube(uSkybox, normalize(vDir));
    }
</script>

<script src="lib/webgl-utils.js"></script>
<script src="lib/initShaders.js"></script>
<script src="lib/MV.js"></script>
<script src="main.js"></script>

<body>
<canvas id="gl-canvas" width="600" height="600">
    Your browser doesn't support HTML5 canvas.
</canvas>
</body>
</html>